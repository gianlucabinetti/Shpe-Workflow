<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHPE FAU Professional Email System</title>
    <style>
        /* Security Screen Styles */
        #loginScreen {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #1e3a5f 0%, #152a45 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10000;
        }
        
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            margin: 0 20px;
            text-align: center;
        }
        
        .login-logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 24px;
        }
        
        .login-logo svg {
            width: 100%;
            height: 100%;
        }
        
        .login-container h1 {
            color: #1e3a5f;
            margin-bottom: 10px;
        }
        
        .login-container p {
            color: #666;
            margin-bottom: 30px;
        }
        
        .login-container input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .login-container input:focus {
            outline: none;
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        .login-container button {
            width: 100%;
            padding: 12px 24px;
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .login-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.3);
        }
        
        .error {
            color: #ef4444;
            margin-top: 16px;
            display: none;
        }
        
        #mainApp {
            display: none;
        }

        /* Main App Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --primary-light: #818CF8;
            --secondary: #EC4899;
            --shpe-navy: #1e3a5f;
            --shpe-orange: #FF6B35;
            --shpe-light-blue: #7FC8E8;
            --dark: #1F2937;
            --light: #F9FAFB;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --border: #E5E7EB;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0F172A;
            min-height: 100vh;
            color: var(--dark);
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(139, 92, 246, 0.2) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-20px, -20px) scale(1.1); }
            66% { transform: translate(20px, -10px) scale(0.95); }
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            max-width: 1200px;
            margin: 40px auto;
            animation: slideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header with SHPE Logo */
        .header {
            background: linear-gradient(135deg, var(--shpe-navy) 0%, #152a45 100%);
            color: white;
            padding: 32px 48px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 40%;
            height: 200%;
            background: rgba(255, 255, 255, 0.05);
            transform: rotate(45deg);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 32px;
            position: relative;
            z-index: 1;
        }

        .shpe-logo {
            height: 60px;
            width: auto;
        }

        .header-text h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .header-text p {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 400;
        }

        .leading-stem {
            color: var(--shpe-orange);
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 48px;
        }

        .form-section {
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            padding: 32px;
            border-radius: 20px;
            margin-bottom: 32px;
            border: 1px solid rgba(99, 102, 241, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
            background-size: 200% 100%;
            animation: gradientSlide 3s linear infinite;
        }

        @keyframes gradientSlide {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.1);
        }

        .form-section h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-group {
            margin-bottom: 28px;
        }

        label {
            display: block;
            color: var(--dark);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 15px;
            letter-spacing: -0.2px;
        }

        input[type="text"], 
        input[type="url"], 
        input[type="email"],
        input[type="file"], 
        select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        input:focus, 
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 
                0 0 0 4px rgba(99, 102, 241, 0.1),
                0 1px 3px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }

        /* Email Editor Container */
        .email-editor-wrapper {
            background: white;
            border-radius: 12px;
            border: 2px solid transparent;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .email-editor-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* Visual Editor Toolbar */
        .editor-toolbar {
            background: #F8FAFC;
            border-bottom: 1px solid var(--border);
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 12px;
            border-right: 1px solid #E5E7EB;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            background: white;
            border: 1px solid #E5E7EB;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            color: #4B5563;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            position: relative;
        }

        .toolbar-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        .toolbar-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .toolbar-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Tooltips */
        .toolbar-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-4px);
            background: #1F2937;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 100;
        }

        .toolbar-btn:hover::after {
            opacity: 1;
        }

        /* Font Size Selector */
        .font-size-selector {
            display: flex;
            align-items: center;
            gap: 6px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 4px;
        }

        .font-size-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            color: #4B5563;
            transition: all 0.2s ease;
        }

        .font-size-btn:hover {
            background: #F3F4F6;
        }

        .font-size-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Visual Editor */
        .visual-editor {
            min-height: 350px;
            padding: 20px;
            font-size: 16px;
            line-height: 1.8;
            color: var(--dark);
            outline: none;
            overflow-y: auto;
            max-height: 500px;
        }

        .visual-editor:focus {
            background: #FAFBFC;
        }

        /* Style links in editor - clean and simple like Gmail */
        .visual-editor a {
            color: #2563EB !important;
            text-decoration: underline !important;
            cursor: text !important;
        }

        .visual-editor a:hover {
            color: #1D4ED8 !important;
        }

        /* Merge Tags Panel */
        .merge-tags-panel {
            background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
            border-top: 1px solid rgba(99, 102, 241, 0.2);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .merge-tags-label {
            color: var(--primary-dark);
            font-weight: 600;
            font-size: 14px;
        }

        .merge-tag {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 6px 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.1);
        }

        .merge-tag:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.2);
        }

        /* Insert Link Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            margin: 100px auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .modal-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 15px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn.primary {
            background: var(--primary);
            color: white;
        }

        .modal-btn.secondary {
            background: #F3F4F6;
            color: #4B5563;
        }

        /* Filter Grid */
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .filter-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .filter-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(99, 102, 241, 0.15);
        }

        .filter-card h4 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Modern Checkboxes */
        .checkbox-group {
            max-height: 320px;
            overflow-y: auto;
            padding-right: 12px;
            margin-top: 12px;
        }

        .checkbox-group::-webkit-scrollbar {
            width: 8px;
        }

        .checkbox-group::-webkit-scrollbar-track {
            background: #F1F5F9;
            border-radius: 4px;
        }

        .checkbox-group::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 4px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .checkbox-item:hover {
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            transform: translateX(4px);
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            position: relative;
            appearance: none;
            border: 2px solid #CBD5E1;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .checkbox-item input[type="checkbox"]:checked {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
        }

        .checkbox-item input[type="checkbox"]:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: 500;
            cursor: pointer;
            font-size: 15px;
            color: #475569;
            flex: 1;
        }

        /* Quick Filter Buttons */
        .quick-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .quick-filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quick-filter-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            z-index: -1;
        }

        .quick-filter-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .quick-filter-btn:hover {
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* Action Buttons */
        .submit-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 18px 48px;
            border-radius: 60px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 12px;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .submit-btn:hover::before {
            width: 600px;
            height: 600px;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }

        .submit-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Actions Container */
        .actions-container {
            text-align: center;
            margin-top: 40px;
        }

        /* Company Autocomplete */
        .company-input-wrapper {
            position: relative;
        }

        .company-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--border);
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 240px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .company-suggestion {
            padding: 14px 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #F3F4F6;
        }

        .company-suggestion:last-child {
            border-bottom: none;
        }

        .company-suggestion:hover {
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            padding-left: 24px;
            color: var(--primary);
        }

        /* Selected Companies */
        #selectedCompanies {
            margin-top: 16px;
        }

        .filter-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 6px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);
            animation: tagPop 0.3s ease;
        }

        @keyframes tagPop {
            from { 
                transform: scale(0.8);
                opacity: 0;
            }
            to { 
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Preview Section */
        .preview-section {
            margin-top: 32px;
            padding: 32px;
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            border-radius: 20px;
            display: none;
            border: 1px solid rgba(99, 102, 241, 0.1);
            animation: fadeIn 0.5s ease;
        }

        .preview-content {
            background: white;
            padding: 32px;
            border-radius: 12px;
            border: 1px solid var(--border);
            line-height: 1.8;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }

        /* Status Messages */
        .status-message {
            margin-top: 24px;
            padding: 20px 24px;
            border-radius: 12px;
            text-align: center;
            display: none;
            animation: slideInNotification 0.5s ease;
            font-weight: 600;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        @keyframes slideInNotification {
            from { 
                opacity: 0; 
                transform: translateY(-20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .status-message.success {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            color: #065F46;
            border: 2px solid #6EE7B7;
        }

        .status-message.error {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            color: #991B1B;
            border: 2px solid #FCA5A5;
        }

        /* Recipient Count */
        #recipientCount {
            margin-top: 24px;
            padding: 32px;
            background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
            border-radius: 16px;
            text-align: center;
            border: 2px solid #BFDBFE;
            position: relative;
            overflow: hidden;
            display: none;
            animation: slideInNotification 0.5s ease;
        }

        #countResult {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        /* Test Mode */
        .test-mode-wrapper {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            border: 2px solid #FCD34D;
            transition: all 0.3s ease;
        }

        .test-mode-wrapper:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(252, 211, 77, 0.3);
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 12px;
            vertical-align: middle;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease;
            z-index: 1000;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.info {
            border-left: 4px solid #3B82F6;
        }

        /* Attachment Styles */
        .attachment-area {
            background: #F8FAFC;
            border: 2px dashed #CBD5E1;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .attachment-area:hover {
            border-color: var(--primary);
            background: #F1F5F9;
        }

        .add-attachment-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .add-attachment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .attachments-list {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .attachment-item {
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #E5E7EB;
            transition: all 0.2s ease;
            animation: slideIn 0.3s ease;
        }

        .attachment-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .attachment-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .attachment-icon {
            font-size: 24px;
        }

        .attachment-details {
            display: flex;
            flex-direction: column;
        }

        .attachment-name {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .attachment-size {
            font-size: 12px;
            color: #6B7280;
        }

        .remove-attachment {
            background: #FEE2E2;
            color: #DC2626;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .remove-attachment:hover {
            background: #DC2626;
            color: white;
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 20px;
            }

            .main-content {
                padding: 32px 24px;
            }

            .header-content {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .submit-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Security Login Screen -->
    <div id="loginScreen">
        <div class="login-container">
            <div class="login-logo">
                <!-- SHPE Logo SVG -->
                <svg viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg">
                    <g transform="translate(150, 150)">
                        <!-- Light Blue Arrow (top) -->
                        <path d="M -30,-50 Q -30,-80 0,-80 Q 30,-80 30,-50 L 20,-20 Q 20,-10 10,-10 L -10,-10 Q -20,-10 -20,-20 Z" 
                              fill="#7FC8E8" transform="rotate(45)"/>
                        
                        <!-- Dark Blue Arrow (bottom) -->
                        <path d="M -30,-50 Q -30,-80 0,-80 Q 30,-80 30,-50 L 20,-20 Q 20,-10 10,-10 L -10,-10 Q -20,-10 -20,-20 Z" 
                              fill="#5A9FD4" transform="rotate(225)"/>
                        
                        <!-- Red/Orange Arrow (left) -->
                        <path d="M -30,-50 Q -30,-80 0,-80 Q 30,-80 30,-50 L 20,-20 Q 20,-10 10,-10 L -10,-10 Q -20,-10 -20,-20 Z" 
                              fill="#E74C3C" transform="rotate(315)"/>
                        
                        <!-- Orange Arrow (right) -->
                        <path d="M -30,-50 Q -30,-80 0,-80 Q 30,-80 30,-50 L 20,-20 Q 20,-10 10,-10 L -10,-10 Q -20,-10 -20,-20 Z" 
                              fill="#FF6B35" transform="rotate(135)"/>
                    </g>
                </svg>
            </div>
            <h1>SHPE FAU Email System</h1>
            <p>Authorized Access Only</p>
            <input type="password" id="accessCode" placeholder="Enter access code" onkeypress="if(event.key==='Enter') checkAccess()">
            <button onclick="checkAccess()">Access System</button>
            <div class="error" id="errorMsg">Invalid access code. Please try again.</div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="mainApp">
        <div class="container">
            <!-- Header with SHPE Logo -->
            <div class="header">
                <div class="header-content">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 150'%3E%3Cdefs%3E%3Cstyle%3E.cls-1{fill:%23fff;}.cls-2{fill:%237FC8E8;}.cls-3{fill:%23FF6B35;}.cls-4{fill:%235A9FD4;}%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class='cls-2' d='M50,30 Q50,10 70,10 T90,30'/%3E%3Cpath class='cls-3' d='M90,30 Q110,30 110,50 T90,70'/%3E%3Cpath class='cls-4' d='M90,70 Q90,90 70,90 T50,70'/%3E%3Cpath class='cls-3' d='M50,70 Q30,70 30,50 T50,30'/%3E%3C/g%3E%3Ctext x='150' y='80' font-family='Arial' font-size='60' font-weight='bold' fill='white'%3ESHPE%3C/text%3E%3C/svg%3E" alt="SHPE Logo" class="shpe-logo">
                    <div class="header-text">
                        <h1>SHPE FAU Professional Email System</h1>
                        <p><span class="leading-stem">Leading Hispanics in STEM®</span> - Professional Outreach Platform</p>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <form id="emailForm">
                    <!-- Configuration -->
                    <div class="form-section">
                        <h3>⚙️ Configuration</h3>
                        <div class="form-group">
                            <label for="n8nWebhookUrl">n8n Webhook URL</label>
                            <input type="url" id="n8nWebhookUrl" name="n8nWebhookUrl" 
                                   placeholder="https://your-n8n-instance.com/webhook/send-professional-emails" 
                                   value="https://example.com/webhook/not-real" required>
                        </div>
                        <div class="test-mode-wrapper">
                            <div class="checkbox-item" style="margin: 0; padding: 0;">
                                <input type="checkbox" id="testMode" name="testMode">
                                <label for="testMode">Test Mode (Preview data without sending emails)</label>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 16px;">
                            <label for="testEmailAddress">Test Email Address (Optional - Send one test email before bulk send)</label>
                            <input type="email" id="testEmailAddress" name="testEmailAddress" 
                                   placeholder="your.email@example.com" 
                                   style="background: #FEF3C7; border-color: #FCD34D;">
                            <div style="margin-top: 8px; color: #78350F; font-size: 14px;">
                                💡 <strong>Tip:</strong> Enter your email to receive a test with sample data before sending to all recipients
                            </div>
                        </div>
                    </div>

                    <!-- Email Content -->
                    <div class="form-section">
                        <h3>✉️ Email Content</h3>
                        <div class="form-group">
                            <label for="emailSubject">Email Subject</label>
                            <input type="text" id="emailSubject" name="emailSubject" 
                                   placeholder="e.g., Invitation to SHPE FAU Tech Workshop" required>
                        </div>

                        <div class="form-group">
                            <label for="emailBody">Email Body</label>
                            <div class="email-editor-wrapper">
                                <!-- Visual Editor Toolbar -->
                                <div class="editor-toolbar">
                                    <div class="toolbar-group">
                                        <button type="button" class="toolbar-btn" onclick="formatText('bold')" data-tooltip="Bold (Ctrl+B)">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h8a4 4 0 100-8H6v8zm0 0h9a4 4 0 010 8H6v-8z"></path>
                                            </svg>
                                        </button>
                                        <button type="button" class="toolbar-btn" onclick="formatText('italic')" data-tooltip="Italic (Ctrl+I)">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 4h4m0 16h-4m4-16l-4 16"></path>
                                            </svg>
                                        </button>
                                        <button type="button" class="toolbar-btn" onclick="formatText('underline')" data-tooltip="Underline (Ctrl+U)">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20h10M7 4v8a5 5 0 0010 0V4"></path>
                                            </svg>
                                        </button>
                                    </div>

                                    <div class="toolbar-group">
                                        <div class="font-size-selector">
                                            <button type="button" class="font-size-btn" onclick="setFontSize('small')" data-size="small">S</button>
                                            <button type="button" class="font-size-btn active" onclick="setFontSize('normal')" data-size="normal">M</button>
                                            <button type="button" class="font-size-btn" onclick="setFontSize('large')" data-size="large">L</button>
                                            <button type="button" class="font-size-btn" onclick="setFontSize('xlarge')" data-size="xlarge">XL</button>
                                        </div>
                                    </div>

                                    <div class="toolbar-group">
                                        <button type="button" class="toolbar-btn" onclick="toggleLink()" data-tooltip="Insert/Remove Link (Ctrl+K)">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                            </svg>
                                        </button>
                                        <button type="button" class="toolbar-btn" onclick="formatText('insertUnorderedList')" data-tooltip="Bullet List">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <!-- Visual Editor (contenteditable) -->
                                <div id="visualEditor" class="visual-editor" contenteditable="true">
Dear {{first_name}},<br><br>
We hope this email finds you well. As a {{specialty}} professional at {{company}} in {{location}}, we would love to invite you to our upcoming event.<br><br>
Best regards,<br>
SHPE FAU Team
                                </div>

                                <!-- Merge Tags -->
                                <div class="merge-tags-panel">
                                    <span class="merge-tags-label">Click to insert:</span>
                                    <span class="merge-tag" onclick="insertMergeTag('{{first_name}}', this)">{{first_name}}</span>
                                    <span class="merge-tag" onclick="insertMergeTag('{{last_name}}', this)">{{last_name}}</span>
                                    <span class="merge-tag" onclick="insertMergeTag('{{company}}', this)">{{company}}</span>
                                    <span class="merge-tag" onclick="insertMergeTag('{{specialty}}', this)">{{specialty}}</span>
                                    <span class="merge-tag" onclick="insertMergeTag('{{location}}', this)">{{location}}</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="emailAttachment">Attachments (Optional)</label>
                            <input type="file" id="emailAttachment" name="emailAttachment" accept=".pdf,.doc,.docx,.png,.jpg,.jpeg" style="display: none;" multiple>
                            <div class="attachment-area">
                                <button type="button" class="add-attachment-btn" onclick="document.getElementById('emailAttachment').click()">
                                    📎 Add Attachment
                                </button>
                                <div id="attachmentsList" class="attachments-list"></div>
                            </div>
                            <div style="margin-top: 8px; color: #6B7280; font-size: 14px;">
                                ⚠️ <strong>Note:</strong> All attachments will be sent to ALL recipients. Max: 5MB per file
                            </div>
                        </div>
                    </div>

                    <!-- Filters Section -->
                    <div class="form-section">
                        <h3>🎯 Advanced Filters</h3>
                        
                        <div style="text-align: center; margin-bottom: 28px;">
                            <button type="button" class="submit-btn" onclick="selectAllProfessionals()" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                                Select All Professionals
                            </button>
                        </div>
                        
                        <div class="filter-grid">
                            <!-- Company Filter -->
                            <div class="filter-card">
                                <h4>🏢 Company</h4>
                                <div class="company-input-wrapper">
                                    <input type="text" id="companyFilter" placeholder="Type to search companies..." 
                                           onkeyup="filterCompanies(this.value)" style="width: 100%;">
                                    <div class="company-suggestions" id="companySuggestions"></div>
                                </div>
                                <div id="selectedCompanies"></div>
                            </div>

                            <!-- Location Filter -->
                            <div class="filter-card">
                                <h4>📍 Location</h4>
                                <div class="quick-filters">
                                    <button type="button" class="quick-filter-btn" onclick="selectAllLocations()">
                                        All Locations
                                    </button>
                                    <button type="button" class="quick-filter-btn" onclick="selectFloridaOnly()">
                                        Florida Only
                                    </button>
                                </div>
                                <div class="checkbox-group" style="max-height: 350px;">
                                    <!-- Florida Locations -->
                                    <div style="font-weight: bold; color: var(--primary); margin: 10px 0 5px 0;">Florida</div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locBoca" value="Boca Raton" name="location">
                                        <label for="locBoca">Boca Raton, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locCoconutCreek" value="Coconut Creek" name="location">
                                        <label for="locCoconutCreek">Coconut Creek, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locCoralGables" value="Coral Gables" name="location">
                                        <label for="locCoralGables">Coral Gables, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locDaytona" value="Daytona Beach" name="location">
                                        <label for="locDaytona">Daytona Beach, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locDeerfield" value="Deerfield Beach" name="location">
                                        <label for="locDeerfield">Deerfield Beach, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locDelray" value="Delray Beach" name="location">
                                        <label for="locDelray">Delray Beach, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locFtLauderdale" value="Fort Lauderdale" name="location">
                                        <label for="locFtLauderdale">Fort Lauderdale, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locGainesville" value="Gainesville" name="location">
                                        <label for="locGainesville">Gainesville, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locJuno" value="Juno Beach" name="location">
                                        <label for="locJuno">Juno Beach, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locJupiter" value="Jupiter" name="location">
                                        <label for="locJupiter">Jupiter, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locLakeWorth" value="Lake Worth" name="location">
                                        <label for="locLakeWorth">Lake Worth, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locMiami" value="Miami" name="location">
                                        <label for="locMiami">Miami, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locMiramar" value="Miramar" name="location">
                                        <label for="locMiramar">Miramar, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locOrlando" value="Orlando" name="location">
                                        <label for="locOrlando">Orlando, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locPalmBeach" value="Palm Beach Gardens" name="location">
                                        <label for="locPalmBeach">Palm Beach Gardens, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locPlantation" value="Plantation" name="location">
                                        <label for="locPlantation">Plantation, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locSunrise" value="Sunrise" name="location">
                                        <label for="locSunrise">Sunrise, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locTamarac" value="Tamarac" name="location">
                                        <label for="locTamarac">Tamarac, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locWPB" value="West Palm Beach" name="location">
                                        <label for="locWPB">West Palm Beach, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locWeston" value="Weston" name="location">
                                        <label for="locWeston">Weston, FL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locFloridaGeneral" value="Florida" name="location">
                                        <label for="locFloridaGeneral">Florida (General)</label>
                                    </div>
                                    
                                    <!-- Out of State -->
                                    <div style="font-weight: bold; color: var(--primary); margin: 20px 0 5px 0;">Out of State</div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locPhoenix" value="Phoenix" name="location">
                                        <label for="locPhoenix">Phoenix, AZ</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locBraceville" value="Braceville" name="location">
                                        <label for="locBraceville">Braceville, IL</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locCovington" value="Covington" name="location">
                                        <label for="locCovington">Covington, LA</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locLakeComo" value="Lake Como" name="location">
                                        <label for="locLakeComo">Lake Como, NJ</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locDoylestown" value="Doylestown" name="location">
                                        <label for="locDoylestown">Doylestown, PA</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locHouston" value="Houston" name="location">
                                        <label for="locHouston">Houston, TX</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locMcKinney" value="McKinney" name="location">
                                        <label for="locMcKinney">McKinney, TX</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locVirginia" value="Virginia" name="location">
                                        <label for="locVirginia">Virginia</label>
                                    </div>
                                    
                                    <!-- Unknown/Blank -->
                                    <div style="font-weight: bold; color: var(--primary); margin: 20px 0 5px 0;">Other</div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="locNA" value="N/A" name="location">
                                        <label for="locNA">N/A or Blank</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Specialty Filter -->
                            <div class="filter-card">
                                <h4>🔧 Specialty/Field</h4>
                                <div class="quick-filters">
                                    <button type="button" class="quick-filter-btn" onclick="selectSpecialtyGroup('engineering')">
                                        All Engineering
                                    </button>
                                    <button type="button" class="quick-filter-btn" onclick="selectSpecialtyGroup('software')">
                                        Software/IT
                                    </button>
                                    <button type="button" class="quick-filter-btn" onclick="selectSpecialtyGroup('hr')">
                                        HR
                                    </button>
                                </div>
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specMechEng" value="Mechanical Engineering" name="specialty">
                                        <label for="specMechEng">Mechanical Engineering</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specElecEng" value="Electrical Engineering" name="specialty">
                                        <label for="specElecEng">Electrical Engineering</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specCompEng" value="Computer Engineering/Science" name="specialty">
                                        <label for="specCompEng">Computer Engineering/Science</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specCivilEng" value="Civil Engineering" name="specialty">
                                        <label for="specCivilEng">Civil Engineering</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specSoftEng" value="Software Engineer" name="specialty">
                                        <label for="specSoftEng">Software Engineer</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specDevOps" value="Devops Engineer" name="specialty">
                                        <label for="specDevOps">DevOps Engineer</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specHR" value="Human Resources" name="specialty">
                                        <label for="specHR">Human Resources</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specHRSpec" value="Human Resources Specialist" name="specialty">
                                        <label for="specHRSpec">HR Specialist</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specCyber" value="Cyber Analyst" name="specialty">
                                        <label for="specCyber">Cyber Analyst</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specSecurity" value="Security Governance" name="specialty">
                                        <label for="specSecurity">Security Governance/Risk/Compliance</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specMaterials" value="Materials Science" name="specialty">
                                        <label for="specMaterials">Materials Science & Engineering</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specOcean" value="Ocean Engineering" name="specialty">
                                        <label for="specOcean">Ocean Engineering</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specAero" value="Aerospace" name="specialty">
                                        <label for="specAero">Aerospace Engineering</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specTransport" value="Transportation Engineer" name="specialty">
                                        <label for="specTransport">Transportation Engineer</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specWater" value="Water/Wastewater Engineer" name="specialty">
                                        <label for="specWater">Water/Wastewater Engineer</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specProject" value="Project Engineer" name="specialty">
                                        <label for="specProject">Project Engineer</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specTraffic" value="Traffic/ITS Engineer" name="specialty">
                                        <label for="specTraffic">Traffic/ITS Engineer</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specUAS" value="UAS Operations" name="specialty">
                                        <label for="specUAS">UAS Operations/Special Projects</label>
                                    </div>
                                    <div class="checkbox-item" style="margin-top: 16px; padding-top: 16px; border-top: 2px solid #F3F4F6;">
                                        <input type="checkbox" id="specNA" value="N/A" name="specialty">
                                        <label for="specNA">N/A or Blank</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Program Participation -->
                        <div class="filter-card" style="margin-top: 24px;">
                            <h4>🎓 Program Participation</h4>
                            <div class="checkbox-group" style="max-height: none; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px;">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterAlumni" name="program" value="fau_alumni">
                                    <label for="filterAlumni">FAU Alumni</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterGBM" name="program" value="attending_gbm">
                                    <label for="filterGBM">GBM Speakers</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterInstagram" name="program" value="instagram_takeover">
                                    <label for="filterInstagram">Instagram Takeover</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterTour" name="program" value="company_tour">
                                    <label for="filterTour">Company Tour</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterSponsorship" name="program" value="sponsorship">
                                    <label for="filterSponsorship">Sponsorship</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterMentor" name="program" value="mentorshpe">
                                    <label for="filterMentor">MentorSHPE</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterShpetinas" name="program" value="shpetinas">
                                    <label for="filterShpetinas">SHPEtinas</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterBBQ" name="program" value="industry_bbq">
                                    <label for="filterBBQ">Industry BBQ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterDiaCiencias" name="program" value="dia_de_ciencias">
                                    <label for="filterDiaCiencias">Dia De Ciencias</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterCompanyEvents" name="program" value="company_sponsored_events">
                                    <label for="filterCompanyEvents">Company Sponsored Events</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="filterPDLeaderSHPE" name="program" value="pd_leadershpe">
                                    <label for="filterPDLeaderSHPE">Professional Development Day / LeaderSHPE</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="actions-container">
                        <button type="button" class="submit-btn" onclick="previewEmail()" style="background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);">
                            Preview Email
                        </button>

                        <button type="button" class="submit-btn" onclick="countRecipients()" style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);">
                            Count Recipients
                        </button>

                        <button type="button" class="submit-btn" onclick="sendTestEmail()" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);">
                            Send Test Email
                        </button>

                        <button type="submit" class="submit-btn">
                            Send Emails
                        </button>
                    </div>

                    <!-- Preview Section -->
                    <div id="previewSection" class="preview-section">
                        <h3 style="color: var(--primary); font-size: 24px; margin-bottom: 20px;">📧 Email Preview</h3>
                        <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                            <div style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 20px; font-weight: bold;">
                                Subject: <span id="previewSubject"></span>
                            </div>
                            <div class="preview-content" id="previewContent"></div>
                        </div>
                    </div>

                    <!-- Recipient Count -->
                    <div id="recipientCount">
                        <h3 style="color: #1E40AF; margin-bottom: 16px; font-size: 24px;">📊 Recipient Count</h3>
                        <div id="countResult"></div>
                        <p style="color: #64748B; margin-top: 12px; font-size: 15px;">Based on your current filter selection</p>
                    </div>

                    <!-- Status Message -->
                    <div id="statusMessage" class="status-message"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Link Modal - Simplified -->
    <div id="linkModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-header">Insert Link</h3>
            <input type="url" id="linkUrl" class="modal-input" placeholder="Enter URL (e.g., www.example.com)">
            <input type="text" id="linkText" class="modal-input" placeholder="Link text (optional)" style="display: none;">
            <div class="modal-buttons">
                <button type="button" class="modal-btn secondary" onclick="closeLinkModal()">Cancel</button>
                <button type="button" class="modal-btn primary" onclick="insertLink()">Add Link</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Single password for all team members
        const VALID_PASSWORD = 'SHPE2024FAU';  // Change this to your desired password
        
        // Check if already authenticated
        const isAuthenticated = sessionStorage.getItem('shpe_authenticated');
        if (isAuthenticated === 'true') {
            showMainApp();
        }
        
        function checkAccess() {
            const code = document.getElementById('accessCode').value;
            
            if (code === VALID_PASSWORD) {
                // Store authentication for this session
                sessionStorage.setItem('shpe_authenticated', 'true');
                showMainApp();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                document.getElementById('accessCode').value = '';
                
                // Log failed attempt (optional)
                console.warn('Failed access attempt:', new Date().toISOString());
            }
        }
        
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Initialize the main app
            initializeEmailSystem();
        }
        
        function initializeEmailSystem() {
            // Add any initialization code here
            console.log('SHPE Email System initialized');
        }
        
        // Auto-logout after 2 hours of inactivity
        let inactivityTimer;
        
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                sessionStorage.removeItem('shpe_authenticated');
                location.reload();
            }, 2 * 60 * 60 * 1000); // 2 hours
        }
        
        // Track activity
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        resetInactivityTimer();

        // Main App Scripts
        // Enhanced company list with more options
        const companies = [
            'WPB', 'Ford', 'Lockheed Martin', 'Northrop Grumman', 'Boeing', 
            'Raytheon', 'General Dynamics', 'L3Harris', 'Microsoft', 'Google',
            'Amazon', 'Apple', 'Meta', 'IBM', 'Oracle', 'Cisco', 'Intel',
            'HP', 'Dell', 'Accenture', 'Deloitte', 'PWC', 'EY', 'KPMG',
            'Tesla', 'SpaceX', 'Blue Origin', 'Palantir', 'Nvidia', 'AMD',
            'Qualcomm', 'Broadcom', 'Texas Instruments', 'Analog Devices'
        ].sort();

        let selectedCompanies = [];
        let currentFontSize = 'normal';
        let attachedFiles = []; // Store multiple attachments

        // Handle file selection
        document.getElementById('emailAttachment').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
                // Check file size
                if (file.size > 5 * 1024 * 1024) {
                    showToast(`File "${file.name}" exceeds 5MB limit`, 'error');
                    return;
                }
                
                // Check if file already attached
                if (attachedFiles.some(f => f.name === file.name)) {
                    showToast(`File "${file.name}" is already attached`, 'error');
                    return;
                }
                
                // Add file to attachments
                attachedFiles.push(file);
                displayAttachments();
                showToast(`Added "${file.name}" to attachments`, 'success');
            });
            
            // Clear the input so the same file can be selected again if removed
            e.target.value = '';
        });

        // Display attached files
        function displayAttachments() {
            const listContainer = document.getElementById('attachmentsList');
            
            if (attachedFiles.length === 0) {
                listContainer.innerHTML = '';
                return;
            }
            
            listContainer.innerHTML = attachedFiles.map((file, index) => {
                const fileIcon = getFileIcon(file.name);
                const fileSize = formatFileSize(file.size);
                
                return `
                    <div class="attachment-item">
                        <div class="attachment-info">
                            <span class="attachment-icon">${fileIcon}</span>
                            <div class="attachment-details">
                                <span class="attachment-name">${file.name}</span>
                                <span class="attachment-size">${fileSize}</span>
                            </div>
                        </div>
                        <button type="button" class="remove-attachment" onclick="removeAttachment(${index})">
                            Remove
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Remove attachment
        function removeAttachment(index) {
            const fileName = attachedFiles[index].name;
            attachedFiles.splice(index, 1);
            displayAttachments();
            showToast(`Removed "${fileName}" from attachments`, 'info');
        }

        // Get file icon based on extension
        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const icons = {
                'pdf': '📄',
                'doc': '📝',
                'docx': '📝',
                'png': '🖼️',
                'jpg': '🖼️',
                'jpeg': '🖼️'
            };
            return icons[ext] || '📎';
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Visual Editor Functions
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('visualEditor').focus();
        }

        function setFontSize(size) {
            const editor = document.getElementById('visualEditor');
            const selection = window.getSelection();
            
            if (selection.toString()) {
                // Apply to selection
                const sizes = {
                    'small': '14px',
                    'normal': '16px',
                    'large': '20px',
                    'xlarge': '24px'
                };
                
                document.execCommand('fontSize', false, '7');
                const fontElements = editor.getElementsByTagName('font');
                for (let i = 0; i < fontElements.length; i++) {
                    if (fontElements[i].size === '7') {
                        fontElements[i].removeAttribute('size');
                        fontElements[i].style.fontSize = sizes[size];
                    }
                }
            }
            
            // Update button states
            document.querySelectorAll('.font-size-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            currentFontSize = size;
            
            editor.focus();
        }

        // FIXED toggleLink function with better link detection
        function toggleLink() {
            const selection = window.getSelection();
            const editor = document.getElementById('visualEditor');
            
            // Check if we're inside a link
            let linkElement = null;
            
            // Get the element where the cursor/selection is
            if (selection.rangeCount > 0) {
                let node = selection.anchorNode;
                
                // If it's a text node, get its parent
                if (node.nodeType === 3) {
                    node = node.parentNode;
                }
                
                // Walk up to find if we're inside a link
                while (node && node !== editor) {
                    if (node.tagName === 'A') {
                        linkElement = node;
                        break;
                    }
                    node = node.parentNode;
                }
            }
            
            if (linkElement) {
                // We found a link - remove it
                const parent = linkElement.parentNode;
                
                // Keep all the text content
                while (linkElement.firstChild) {
                    parent.insertBefore(linkElement.firstChild, linkElement);
                }
                
                // Remove the empty link element
                parent.removeChild(linkElement);
                
                showToast('Link removed', 'success');
                
                // Clear selection and refocus editor
                selection.removeAllRanges();
                editor.focus();
            } else {
                // No link found - check if text is selected to add a link
                const selectedText = selection.toString().trim();
                
                if (selectedText) {
                    // Text is selected, show modal to add link
                    showLinkModal();
                } else {
                    showToast('Please select text to add a link, or click on existing linked text to remove it', 'info');
                }
            }
        }

        function showLinkModal() {
            document.getElementById('linkModal').style.display = 'block';
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkText').value = '';
            
            // If text is selected, use it as default link text
            const selection = window.getSelection();
            if (selection.toString()) {
                document.getElementById('linkText').value = selection.toString();
            }
        }

        function closeLinkModal() {
            document.getElementById('linkModal').style.display = 'none';
        }

        function insertLink() {
            const url = document.getElementById('linkUrl').value;
            const text = document.getElementById('linkText').value || url;
            
            if (!url) {
                showToast('Please enter a URL', 'error');
                return;
            }
            
            const editor = document.getElementById('visualEditor');
            const selection = window.getSelection();
            
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                
                const link = document.createElement('a');
                link.href = url;
                link.textContent = text;
                link.style.color = '#6366F1';
                link.style.textDecoration = 'underline';
                link.contentEditable = 'false';
                link.onclick = function(e) {
                    e.preventDefault();
                    showToast('This link will work in the actual email', 'info');
                    return false;
                };
                
                range.insertNode(link);
                
                // Add a space after the link
                const space = document.createTextNode(' ');
                link.parentNode.insertBefore(space, link.nextSibling);
                
                // Move cursor after the link
                range.setStartAfter(space);
                range.setEndAfter(space);
                selection.removeAllRanges();
                selection.addRange(range);
            }
            
            closeLinkModal();
            editor.focus();
            showToast('Link added! It will be clickable in the sent email.', 'success');
        }

        // FIXED insertMergeTag function - inserts at cursor position
        function insertMergeTag(tag, buttonElement) {
            const editor = document.getElementById('visualEditor');
            
            // Focus the editor
            editor.focus();
            
            // Store the current selection/cursor position
            const selection = window.getSelection();
            let range;
            
            // Check if we have a valid selection in the editor
            if (selection.rangeCount > 0) {
                range = selection.getRangeAt(0);
                
                // Make sure the selection is actually in our editor
                if (!editor.contains(range.commonAncestorContainer)) {
                    // If not, create a new range at the end of the editor
                    range = document.createRange();
                    range.selectNodeContents(editor);
                    range.collapse(false);
                }
            } else {
                // No selection, create a range at the end
                range = document.createRange();
                range.selectNodeContents(editor);
                range.collapse(false);
            }
            
            // Create the tag element as a text node first (makes it easier to move)
            const tagText = document.createTextNode(tag);
            
            // Insert the plain text tag at cursor position
            range.deleteContents();
            range.insertNode(tagText);
            
            // Now wrap it in a styled span
            const tagNode = document.createElement('span');
            tagNode.style.background = 'linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%)';
            tagNode.style.padding = '2px 6px';
            tagNode.style.borderRadius = '4px';
            tagNode.style.fontWeight = '600';
            tagNode.style.color = '#4338CA';
            tagNode.style.display = 'inline-block';
            tagNode.style.margin = '0 2px';
            tagNode.contentEditable = 'false';
            tagNode.style.userSelect = 'all'; // Makes it easier to select and move
            tagNode.style.cursor = 'move'; // Shows it can be moved
            
            // Replace the text node with the styled span
            tagText.parentNode.replaceChild(tagNode, tagText);
            tagNode.textContent = tag;
            
            // Add a space after the tag for better UX
            const spaceNode = document.createTextNode('\u00A0'); // Non-breaking space
            tagNode.parentNode.insertBefore(spaceNode, tagNode.nextSibling);
            
            // Move cursor after the space so user can continue typing
            const newRange = document.createRange();
            newRange.setStartAfter(spaceNode);
            newRange.setEndAfter(spaceNode);
            selection.removeAllRanges();
            selection.addRange(newRange);
            
            // Keep focus on the editor
            editor.focus();
            
            // Visual feedback on the button - Fixed to use passed element
            if (buttonElement) {
                buttonElement.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    buttonElement.style.transform = 'scale(1)';
                }, 200);
            }
            
            // Show success toast
            showToast(`Inserted ${tag} at cursor position`, 'success');
        }

        // Add this helper function to save cursor position when clicking outside editor
        let savedSelection = null;
        
        document.getElementById('visualEditor').addEventListener('blur', function() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                savedSelection = selection.getRangeAt(0);
            }
        });
        
        document.getElementById('visualEditor').addEventListener('focus', function() {
            if (savedSelection) {
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(savedSelection);
                savedSelection = null;
            }
        });

        // Company Filter Functions
        function filterCompanies(value) {
            const suggestions = document.getElementById('companySuggestions');
            if (!value) {
                suggestions.style.display = 'none';
                return;
            }

            const filtered = companies.filter(company => 
                company.toLowerCase().includes(value.toLowerCase()) &&
                !selectedCompanies.includes(company)
            );

            if (filtered.length === 0) {
                suggestions.innerHTML = '<div class="company-suggestion" style="color: #94A3B8; font-style: italic;">No matching companies found</div>';
                suggestions.style.display = 'block';
                return;
            }

            suggestions.innerHTML = filtered.map(company => 
                `<div class="company-suggestion" onclick="selectCompany('${company}')">${company}</div>`
            ).join('');
            suggestions.style.display = 'block';
        }

        function selectCompany(company) {
            if (!selectedCompanies.includes(company)) {
                selectedCompanies.push(company);
                updateSelectedCompanies();
            }
            document.getElementById('companyFilter').value = '';
            document.getElementById('companySuggestions').style.display = 'none';
            
            showToast(`Added ${company} to filters`, 'success');
        }

        function updateSelectedCompanies() {
            const container = document.getElementById('selectedCompanies');
            if (selectedCompanies.length === 0) {
                container.innerHTML = '<p style="color: #94A3B8; font-style: italic; margin-top: 12px;">No companies selected</p>';
                return;
            }
            
            container.innerHTML = selectedCompanies.map(company => 
                `<span class="filter-tag">${company} <span onclick="removeCompany('${company}')" style="cursor: pointer; margin-left: 5px;">×</span></span>`
            ).join('');
        }

        function removeCompany(company) {
            selectedCompanies = selectedCompanies.filter(c => c !== company);
            updateSelectedCompanies();
        }

        // Filter Functions
        function selectAllProfessionals() {
            selectedCompanies = [];
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if ((cb.name === 'location' || cb.name === 'specialty' || cb.name === 'program') && !cb.checked) {
                    cb.checked = true;
                }
            });
            showToast('All professionals selected!', 'success');
        }

        function selectAllLocations() {
            document.querySelectorAll('input[name="location"]').forEach(cb => cb.checked = true);
            showToast('All locations selected!', 'success');
        }

        function selectFloridaOnly() {
            document.querySelectorAll('input[name="location"]').forEach(cb => {
                const label = cb.parentElement.querySelector('label').textContent;
                cb.checked = label.includes('FL');
            });
            showToast('Florida locations selected!', 'success');
        }

        function selectSpecialtyGroup(group) {
            const groups = {
                'engineering': ['specMechEng', 'specElecEng', 'specCompEng', 'specCivilEng', 'specMaterials', 'specOcean', 'specAero', 'specTransport', 'specWater', 'specProject', 'specTraffic'],
                'software': ['specCompEng', 'specSoftEng', 'specDevOps', 'specCyber', 'specSecurity'],
                'hr': ['specHR', 'specHRSpec']
            };
            
            document.querySelectorAll('input[name="specialty"]').forEach(cb => cb.checked = false);
            
            if (groups[group]) {
                groups[group].forEach(id => {
                    const cb = document.getElementById(id);
                    if (cb) cb.checked = true;
                });
            }
            
            showToast(`${group.charAt(0).toUpperCase() + group.slice(1)} specialties selected!`, 'success');
        }

        // Preview Email
        function previewEmail() {
            const subject = document.getElementById('emailSubject').value;
            const editorContent = document.getElementById('visualEditor').innerHTML;
            
            if (!subject || !editorContent) {
                showToast('Please fill in subject and body before previewing', 'error');
                return;
            }
            
            const previewSection = document.getElementById('previewSection');
            document.getElementById('previewSubject').textContent = subject;
            
            // Replace merge tags with sample values
            let preview = editorContent
                .replace(/{{first_name}}/g, '<span style="background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%); padding: 2px 6px; border-radius: 4px; font-weight: 600;">John</span>')
                .replace(/{{last_name}}/g, '<span style="background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%); padding: 2px 6px; border-radius: 4px; font-weight: 600;">Doe</span>')
                .replace(/{{company}}/g, '<span style="background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%); padding: 2px 6px; border-radius: 4px; font-weight: 600;">Tech Corp</span>')
                .replace(/{{specialty}}/g, '<span style="background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%); padding: 2px 6px; border-radius: 4px; font-weight: 600;">Software Engineer</span>')
                .replace(/{{location}}/g, '<span style="background: linear-gradient(135deg, #E0E7FF 0%, #C7D2FE 100%); padding: 2px 6px; border-radius: 4px; font-weight: 600;">Miami, FL</span>');
            
            document.getElementById('previewContent').innerHTML = preview;
            previewSection.style.display = 'block';
            previewSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            showToast('Email preview generated!', 'success');
        }

        // Count Recipients
        async function countRecipients() {
            const btn = event.target;
            const originalContent = btn.innerHTML;
            btn.innerHTML = 'Counting Recipients<span class="loading"></span>';
            btn.disabled = true;
            
            const formData = {
                count_only: true,
                filters: {
                    companies: selectedCompanies,
                    locations: Array.from(document.querySelectorAll('input[name="location"]:checked')).map(cb => cb.value),
                    specialties: Array.from(document.querySelectorAll('input[name="specialty"]:checked')).map(cb => cb.value),
                    programs: Array.from(document.querySelectorAll('input[name="program"]:checked')).map(cb => cb.value)
                }
            };
            
            const webhookUrl = document.getElementById('n8nWebhookUrl').value;
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const count = result.recipient_count || result.emails_that_would_be_sent || 0;
                    
                    document.getElementById('countResult').innerHTML = `${count} <span style="font-size: 24px; font-weight: 400;">Recipients</span>`;
                    document.getElementById('recipientCount').style.display = 'block';
                    document.getElementById('recipientCount').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    throw new Error('Failed to count recipients');
                }
            } catch (error) {
                showToast('Error counting recipients. Please check your webhook URL.', 'error');
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        }

        // Send Test Email Function
        async function sendTestEmail() {
            const testEmail = document.getElementById('testEmailAddress').value;
            
            if (!testEmail) {
                showToast('Please enter a test email address', 'error');
                return;
            }
            
            // Validation
            const emailSubject = document.getElementById('emailSubject').value;
            const emailBody = document.getElementById('visualEditor').innerHTML;
            
            if (!emailSubject || !emailBody || emailBody === '<br>') {
                showToast('Please fill in email subject and body first', 'error');
                return;
            }
            
            const btn = event.target;
            const originalContent = btn.innerHTML;
            btn.innerHTML = 'Sending Test Email<span class="loading"></span>';
            btn.disabled = true;
            
            const formData = {
                email_subject: emailSubject,
                email_body: emailBody,
                email_format: 'html',
                test_email_address: testEmail,
                filters: {
                    companies: selectedCompanies,
                    locations: Array.from(document.querySelectorAll('input[name="location"]:checked')).map(cb => cb.value),
                    specialties: Array.from(document.querySelectorAll('input[name="specialty"]:checked')).map(cb => cb.value),
                    programs: Array.from(document.querySelectorAll('input[name="program"]:checked')).map(cb => cb.value)
                }
            };
            
            const webhookUrl = document.getElementById('n8nWebhookUrl').value;
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showToast(`Test email sent to ${testEmail}! Check your inbox.`, 'success');
                    
                    if (result.total_recipients_would_receive) {
                        showToast(`This email would be sent to ${result.total_recipients_would_receive} recipients`, 'info');
                    }
                } else {
                    throw new Error('Failed to send test email');
                }
            } catch (error) {
                showToast('Error sending test email. Please check your webhook URL.', 'error');
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        }

        // Show Toast Notification
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
            toast.innerHTML = `${icon} ${message}`;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Form Submit
        document.getElementById('emailForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalContent = submitBtn.innerHTML;
            
            // Validation
            const emailSubject = document.getElementById('emailSubject').value;
            const emailBody = document.getElementById('visualEditor').innerHTML;
            
            if (!emailSubject || !emailBody || emailBody === '<br>') {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Check if any filters are selected
            const hasFilters = selectedCompanies.length > 0 ||
                document.querySelectorAll('input[name="location"]:checked').length > 0 ||
                document.querySelectorAll('input[name="specialty"]:checked').length > 0 ||
                document.querySelectorAll('input[name="program"]:checked').length > 0;
            
            if (!hasFilters) {
                showToast('Please select at least one filter before sending emails', 'error');
                return;
            }
            
            const isTestMode = document.getElementById('testMode').checked;
            
            // Confirm before sending
            if (!isTestMode) {
                const confirmed = confirm('Are you sure you want to send these emails? This action cannot be undone.');
                if (!confirmed) return;
            }
            
            submitBtn.innerHTML = 'Sending Emails<span class="loading"></span>';
            submitBtn.disabled = true;
            
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.style.display = 'none';
            
            // Handle multiple attachments
            let attachmentsData = [];
            
            if (attachedFiles.length > 0) {
                // Check total size
                const totalSize = attachedFiles.reduce((sum, file) => sum + file.size, 0);
                if (totalSize > 10 * 1024 * 1024) { // 10MB total limit
                    showToast('Total attachments size exceeds 10MB limit', 'error');
                    submitBtn.innerHTML = originalContent;
                    submitBtn.disabled = false;
                    return;
                }
                
                // Convert all files to base64
                for (const file of attachedFiles) {
                    const reader = new FileReader();
                    const fileData = await new Promise((resolve) => {
                        reader.onload = (e) => {
                            resolve({
                                filename: file.name,
                                content: e.target.result.split(',')[1],
                                type: file.type
                            });
                        };
                        reader.readAsDataURL(file);
                    });
                    attachmentsData.push(fileData);
                }
            }
            
            const formData = {
                email_subject: emailSubject,
                email_body: emailBody,
                email_format: 'html',
                test_mode: isTestMode,
                attachments: attachmentsData, // Changed from attachment to attachments (plural)
                filters: {
                    companies: selectedCompanies,
                    locations: Array.from(document.querySelectorAll('input[name="location"]:checked')).map(cb => cb.value),
                    specialties: Array.from(document.querySelectorAll('input[name="specialty"]:checked')).map(cb => cb.value),
                    programs: Array.from(document.querySelectorAll('input[name="program"]:checked')).map(cb => cb.value)
                }
            };
            
            const webhookUrl = document.getElementById('n8nWebhookUrl').value;
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.test_mode) {
                        statusMessage.className = 'status-message success';
                        statusMessage.innerHTML = `🧪 <strong>Test Mode:</strong> Would send emails to ${result.emails_that_would_be_sent} recipients (no emails actually sent)`;
                    } else {
                        statusMessage.className = 'status-message success';
                        statusMessage.innerHTML = `✅ <strong>Success!</strong> Emails sent to ${result.emails_sent} recipients`;
                    }
                    statusMessage.style.display = 'block';
                    statusMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                    // Success animation
                    confetti();
                    
                    setTimeout(() => {
                        if (confirm('Would you like to send another batch of emails?')) {
                            resetForm();
                        }
                    }, 3000);
                } else {
                    throw new Error('Failed to send emails');
                }
            } catch (error) {
                statusMessage.className = 'status-message error';
                statusMessage.innerHTML = `❌ <strong>Error:</strong> ${error.message}. Please check your webhook URL and try again.`;
                statusMessage.style.display = 'block';
            } finally {
                submitBtn.innerHTML = originalContent;
                submitBtn.disabled = false;
            }
        });

        // Reset form
        function resetForm() {
            document.getElementById('emailSubject').value = '';
            document.getElementById('visualEditor').innerHTML = 'Dear {{first_name}},<br><br>We hope this email finds you well. As a {{specialty}} professional at {{company}} in {{location}}, we would love to invite you to our upcoming event.<br><br>Best regards,<br>SHPE FAU Team';
            attachedFiles = []; // Clear attached files
            displayAttachments(); // Clear the display
            selectedCompanies = [];
            updateSelectedCompanies();
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if (cb.id !== 'testMode') cb.checked = false;
            });
            document.getElementById('statusMessage').style.display = 'none';
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('recipientCount').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Simple confetti animation
        function confetti() {
            const colors = ['#6366F1', '#EC4899', '#10B981', '#F59E0B', '#EF4444'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                confetti.style.borderRadius = '50%';
                confetti.style.zIndex = '9999';
                confetti.style.pointerEvents = 'none';
                
                document.body.appendChild(confetti);
                
                const duration = Math.random() * 3 + 2;
                const distance = Math.random() * 300 + 100;
                const rotation = Math.random() * 360;
                
                confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${distance}px) rotate(${rotation}deg)`, opacity: 0 }
                ], {
                    duration: duration * 1000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                }).onfinish = () => confetti.remove();
            }
        }

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Hide company suggestions on outside click
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.company-input-wrapper')) {
                document.getElementById('companySuggestions').style.display = 'none';
            }
        });

        // Initialize
        updateSelectedCompanies();

        // Handle Enter key in visual editor
        document.getElementById('visualEditor').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.execCommand('insertHTML', false, '<br><br>');
            }
        });

        // Preserve formatting when pasting
        document.getElementById('visualEditor').addEventListener('paste', function(e) {
            e.preventDefault();
            const text = e.clipboardData.getData('text/plain');
            document.execCommand('insertText', false, text);
        });

        // Handle keyboard shortcuts in editor
        document.getElementById('visualEditor').addEventListener('keydown', function(e) {
            // Ctrl+K or Cmd+K for links
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                toggleLink();
            }
        });
        
        // Allow clicking links with Ctrl/Cmd to preview
        document.getElementById('visualEditor').addEventListener('click', function(e) {
            if (e.target.tagName === 'A' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                window.open(e.target.href, '_blank');
            }
        });
    </script>
</body>
</html>="specHRSpec">HR Specialist</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="specCyber" value="Cyber Analyst" name="specialty">
                                        <label for
